<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
	*{
		margin: 0;
		padding: 0;
	}
	.wrapper{
		overflow: hidden;
	}
	.x-axis{
		margin-left: 30px;
		overflow: hidden;
	}
	.y-axis{
		width: 30px;
		float: left;
	}
	.x-num{
		display: block;
		float: left;
		width: 40px;
		height: 30px;
		line-height: 30px;
		text-align: center;
	}
	.y-num{
		display: block;
		width: 30px;
		height: 40px;
		text-align: center;
		line-height: 40px;
	}
	.map-zone{
		width: 400px;
		height: 400px;
		border: 2px solid black;
		float: left;
		position: relative;
	}
	.map-cell{
		display: block;
		float: left;
		width: 39px;
		height: 39px;
		border: 1px solid gray;
		border-left: none;
		border-top: none;
	}
	.controller{
		margin: 20px 0 0 30px;
	}
	.box{
		width: 39px;
		height: 31px;
		background: red;
		border-top: 8px solid blue;
		position: absolute;
		left: 80px;
		top: 80px;
		/* transform: rotate(90deg); */
	}
	</style>
</head>
<body>
<div class="wrapper">
	<div class="x-axis">
		<span class="x-num">1</span><span class="x-num">2</span><span class="x-num">3</span>
		<span class="x-num">4</span><span class="x-num">5</span><span class="x-num">6</span>
		<span class="x-num">7</span><span class="x-num">8</span><span class="x-num">9</span>
		<span class="x-num">10</span>
	</div>
	<div style="overflow: hidden;">
		<div class="y-axis">
			<span class="y-num">1</span><span class="y-num">2</span><span class="y-num">3</span>
			<span class="y-num">4</span><span class="y-num">5</span><span class="y-num">6</span>
			<span class="y-num">7</span><span class="y-num">8</span><span class="y-num">9</span>
			<span class="y-num">10</span>
		</div>
		<div class="map-zone">
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<div class="box">
				
			</div>
		</div>
	</div>
	<div class="controller">
		<input type="text"></input>
		<button>执行</button>
	</div>
</div>
<script type="text/javascript">
function Box (box){
	this.box = box,
	this.boxDeg = 0
};
Box.prototype = {
	constructor: Box,
	degChange: function(type){
		var boxDeg = {name: 'boxDeg'};
		if(type == 'left'){
			boxDeg.dis = -90
		}else if(type == 'right'){
			boxDeg.dis = 90
		} else{
			boxDeg.dis = 180
		}
		this.doMove(boxDeg);
	},
	tlFunc: function(){
		var type = 'left';
		this.degChange(type);
	},
	trFunc: function(){
		var type = 'right';
		this.degChange(type);
	},
	tbFunc: function(){
		var type = 'back';
		this.degChange(type);
	},
	goFunc: function(){
		var boxDeg = 0;
		boxDeg = this.boxDeg % 360;
		//需要兼容性处理
		var curPos = getComputedStyle(this.box, null);
		var temPos = {};
		console.log(curPos.top)
		if(boxDeg == 0){
			temPos.pos = curPos.top;
			temPos.dire = 'top';
			temPos.dis = -40;
		}else if(boxDeg == 90){
			temPos.pos = curPos.left;
			temPos.dire = 'left';
			temPos.dis = 40;
		}else if(boxDeg == 180){
			temPos.pos = curPos.top;
			temPos.dire = 'top';
			temPos.dis = 40;
		}else{
			temPos.pos = curPos.left;
			temPos.dire = 'left';
			temPos.dis = -40;
		}
		console.log(temPos)
		this.doMove(temPos);
	},
	tranlFunc: function(){
		var curPos = getComputedStyle(this.box, null);
		var temPos = {};
		temPos.pos = curPos.left;
		temPos.dire = 'left';
		temPos.dis = -40;
		this.doMove(temPos)
	},
	movlFunc: function(){
		var curPos = getComputedStyle(this.box, null);
		var temPos = {};
		temPos.pos = curPos.left;
		temPos.dire = 'left';
		temPos.dis = -40;
		var boxDeg = {name: 'boxDeg'};
		boxDeg.dis = -90;
		this.doMove(boxDeg, temPos)
	},
	doMove: function(deg, pos){
		if (arguments.length == 1){
			if(arguments[0].dire){
				var pos = arguments[0];
				var deg = null;
			}else if(arguments[0].name == 'boxDeg'){
				var deg = arguments[0];
				var pos = null;
			}
		}
		var oThis = this;
		var flag = false;
		var t = 0;
		function animatePos(){
			console.log(tempPos == parseInt(pos.pos) + pos.dis)
			tempPos += pos.dis/20;

			oThis.box.style[pos.dire] = tempPos + 'px';
			
			/*this.box.style.transform = 'rotate('+ deg/10 +'deg)';*/
			if (tempPos == parseInt(pos.pos) + pos.dis) {
				clearInterval(t)
			}
		}
		function animateDeg(){
			tempDeg += deg.dis/10;
			oThis.box.style.transform = 'rotate('+ tempDeg +'deg)';
			if(tempDeg == oThis.boxDeg + deg.dis){
				clearInterval(p);
				oThis.boxDeg = tempDeg
				//结束时检查是否有移动命令，有的话执行
				if (pos) {
					t = setInterval(animatePos, 50);
				}
			}
		}
		if(deg){
			var tempDeg = this.boxDeg;
			var p = setInterval(animateDeg, 50);
			if (pos) {
				var tempPos = parseInt(pos.pos);
			}
		}else if(pos){
			var tempPos = parseInt(pos.pos);
			var t = setInterval(animatePos, 50);
		}
	}	
}
window.onload = function(){
	var oBox = document.getElementsByClassName('box')[0];
	var oContr = document.getElementsByClassName('controller')[0];
	var oBtn = oContr.getElementsByTagName('button')[0];
	var oInp = oContr.getElementsByTagName('input')[0];

	var obj = new Box(oBox);
	//commands对象用于储存命令名和对应方法
	var commands = {
		'GO': obj.goFunc,
		'TL': obj.tlFunc,
		'TR': obj.trFunc,
		'TB': obj.tbFunc,
		'TRA LEF': obj.tranlFunc,
		'MOV LEF': obj.movlFunc
	}
	//用call调用obj的，否则方法识别this时会出错
	oBtn.onclick = function(){
		commands[oInp.value].call(obj)
	};
	
	
}
</script>
</body>
</html>