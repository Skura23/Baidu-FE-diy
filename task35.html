<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
	*{
		margin: 0;
		padding: 0;
	}
	.wrapper{
		overflow: hidden;
	}
	.x-axis{
		margin-left: 30px;
		overflow: hidden;
	}
	.y-axis{
		width: 30px;
		float: left;
	}
	.x-num{
		display: block;
		float: left;
		width: 40px;
		height: 30px;
		line-height: 30px;
		text-align: center;
	}
	.y-num{
		display: block;
		width: 30px;
		height: 40px;
		text-align: center;
		line-height: 40px;
	}
	.map-zone{
		width: 400px;
		height: 400px;
		border: 2px solid black;
		float: left;
		position: relative;
	}
	.map-cell{
		display: block;
		float: left;
		width: 39px;
		height: 39px;
		border: 1px solid gray;
		border-left: none;
		border-top: none;
	}
	.controller{
		margin: 20px 0 0 30px;
	}
	.box{
		width: 39px;
		height: 31px;
		background: red;
		border-top: 8px solid blue;
		position: absolute;
		left: 80px;
		top: 80px;
		/* transform: rotate(90deg); */
	}
	.cmd-panel{
		margin-top: 20px;
	}
	.panel-nums{
		display: block;
		width: 20px;
		min-height: 101px;
		background: gray;
		position: absolute;
	}
	.cmd-panel textarea{
		height: 100px;
		background: black;
		color: #fff;
		line-height: 20px;
		margin-left: 3px;
	}
	.panel-nums span
	{	
		display: block;
		width: 20px;
		height: 20px;
		color: black;
		text-align: center;
	}
	.num-wra{
		width: 20px;
		height: 101px;
		overflow: hidden;
		float: left;
		position: relative;
	}
	</style>
</head>
<body>
<div class="wrapper">
	<div class="x-axis">
		<span class="x-num">1</span><span class="x-num">2</span><span class="x-num">3</span>
		<span class="x-num">4</span><span class="x-num">5</span><span class="x-num">6</span>
		<span class="x-num">7</span><span class="x-num">8</span><span class="x-num">9</span>
		<span class="x-num">10</span>
	</div>
	<div style="overflow: hidden;">
		<div class="y-axis">
			<span class="y-num">1</span><span class="y-num">2</span><span class="y-num">3</span>
			<span class="y-num">4</span><span class="y-num">5</span><span class="y-num">6</span>
			<span class="y-num">7</span><span class="y-num">8</span><span class="y-num">9</span>
			<span class="y-num">10</span>
		</div>
		<div class="map-zone">
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span><span class="map-cell"></span>
			<div class="box">
				
			</div>
		</div>
	</div>
	<div class="controller">
		<input type="text"></input>
		<button>执行</button><button>清空</button>
		<div class="cmd-panel">
			<div class="num-wra">
				<div class="panel-nums"></div>
			</div>
			<textarea></textarea>
		</div>
		
	</div>
</div>
<script type="text/javascript">
function Box (box){
	this.box = box,
	this.boxDeg = 0
};
Box.prototype = {
	constructor: Box,
	//tun, go的运行由其函数内部进行判断
	//以tun, go作为单位动作,参数有times, dir, 分别代表次数和方向
	tunFunc: function(cmdDir){
		var argus = {};
		if(cmdDir == 'LEF'){
			argus.dis  = -1;
		}else if(cmdDir == 'RIG'){
			argus.dis  = 1;
		}else if(cmdDir == 'BAC'){
			argus.dis  = 2;
		}
		this.degMove(argus);
	},
	goFunc: function(cmdTimes){
		var boxDeg = 0;
		boxDeg = this.boxDeg % 360;
		var argus = {};
		if(boxDeg == 0){
			argus.type = 'top';
			argus.dir = -1;
		}else if(boxDeg == 90){
			argus.type = 'left';
			argus.dir = 1;
		}else if(boxDeg == 180){
			argus.type = 'top';
			argus.dir = 1;
		}else if(boxDeg == 270){
			argus.type = 'left';
			argus.dir = -1;
		}
		argus.times = cmdTimes ? cmdTimes : 1;
		this.posMove(argus);
	},
	traFunc: function(cmdDir, cmdTimes){
		var argus = {};
		if (cmdDir == 'LEF') {
			argus.type = 'left';
			argus.dir = -1;
		}else if(cmdDir == 'RIG'){
			argus.type = 'left';
			argus.dir = 1;
		}else if(cmdDir == 'TOP'){
			argus.type = 'top';
			argus.dir = -1;
		}else if(cmdDir == 'BOT'){
			argus.type = 'top';
			argus.dir = 1;
		}
		argus.times = cmdTimes ? cmdTimes : 1;
		this.posMove(argus)
	},
	movFunc: function(cmdDir, cmdTimes){
		var argus = {};
		if (cmdDir == 'LEF') {
			argus.dest = 270;
		}else if(cmdDir == 'RIG'){
			argus.dest = 90;
		}else if(cmdDir == 'TOP'){
			argus.dest = 0;
		}else if(cmdDir == 'BOT'){
			argus.dest = 180;
		}
		var startDeg = this.boxDeg;
		//使box转角大于180时，择小角度旋转
		if(Math.abs(argus.dest - startDeg) > 180){
			if(argus.dest > startDeg){
				argus.dis = (argus.dest - startDeg -360) / 90;
			}else if(argus.dest < startDeg){
				argus.dis = (360 - (startDeg - argus.dest)) / 90;
			}
		}else{
			argus.dis = (argus.dest - startDeg) / 90;
		}
		this.degMove(argus);
		argus.go = true;
		argus.times = cmdTimes ? cmdTimes : 1;
	},
	degMove: function(argus){
		var oThis = this;
		var startDeg = this.boxDeg;
		var curDeg = startDeg;
		function animateDeg(){
			curDeg += argus.dis * 90 / 10;
			oThis.box.style.transform = 'rotate('+ curDeg +'deg)';
			if(curDeg == startDeg + 90 * argus.dis){
				clearInterval(t);
				oThis.boxDeg = curDeg % 360;
				//如果参数go为true则执行go否则执行下个cmd
				argus.go ? oThis.goFunc(argus.times) : oThis.begin();
			}
		}
		var t = setInterval(animateDeg, 50)
	},
	posMove: function (argus){
		var oThis = this;
		//需要兼容性处理
		//获取当前位置
		var startPos = parseInt(getComputedStyle(this.box, null)[argus.type]);
		var curPos = startPos;
		function animatePos(){
			console.log(curPos == parseInt(argus.pos) + 40 * argus.dir)
			curPos += (40 * argus.times * argus.dir)/10;
			oThis.box.style[argus.type] = curPos + 'px';
			if (curPos == startPos + 40 * argus.dir * argus.times) {
				clearInterval(p);
				oThis.begin();
			}
		}
		var p = setInterval(animatePos, 50)
	},
	
	//外部命令转换系统，将外部命令转换为对象内部语言
	cmdHandler: function(cmd){
		var abbrCmd = cmd.slice(0, 3);
		var cmdDir = cmd.slice(4, 7);
		var cmdTimes = cmd.slice(8, 9);
		cmd.indexOf('GO') != -1 && (abbrCmd = cmd.slice(0, 2), cmdTimes = cmd.slice(3, 4));
		abbrObjCmd = abbrCmd.toLowerCase() + 'Func';
		console.log(abbrObjCmd);
		abbrObjCmd == 'goFunc' ? this[abbrObjCmd](cmdTimes) : this[abbrObjCmd](cmdDir, cmdTimes);
	},
	begin: function(){
		console.log(this.index)
		var command = this.cmds[this.index].toUpperCase();
		this.cmdHandler(command);
		this.index ++;
	}
}
window.onload = function(){
	var oBox = document.getElementsByClassName('box')[0];
	var oContr = document.getElementsByClassName('controller')[0];
	var oBtn = oContr.getElementsByTagName('button')[0];
	var oInp = oContr.getElementsByTagName('input')[0];
	var clearBtn = oContr.getElementsByTagName('button')[1];
	var panel = document.getElementsByClassName('cmd-panel')[0];
	var panelNums = panel.getElementsByClassName('panel-nums')[0];
	var panelTxt = panel.getElementsByTagName('textarea')[0];
	var cmdsArr = ['GO', 'TUN LEF', 'TUN RIG', 'TUN BAC', 'TRA LEF', 'TRA TOP', 'TRA RIG', 'TRA BOT', 'MOV LEF', 'MOV TOP', 'MOV RIG', 'MOV BOT']

	var obj = new Box(oBox);
	//获取textarea的命令集合
	//通过callback回调函数方法，将对象状态返回给控制台，根据状态触发命令
	oBtn.onclick = function(){
		obj.cmds = panelTxt.value.split('\n');
		//检查命令是否错误
		checkCmds()
		obj.index = 0;
		obj.begin();
	};
	panelTxt.onkeyup = function(){
		this.rowData = [];
		console.log(this.value.split('\n').length);
		var numLen = this.value.split('\n').length;
		//获取数组
		for( var i = 1; i < numLen + 1; i++){
			this.rowData.push(i)
		}
		//渲染
		renderNums(this.rowData)
		console.log(this.rowData)
	}
	//渲染左侧行数标识
	function renderNums (rowData){
		panelNums.innerHTML = ''
		for( var i = 0; i < rowData.length; i++){
			var oSpan = document.createElement('span');
			oSpan.textContent = rowData[i];
			panelNums.appendChild(oSpan)
		}
	}
	//确保num指示可随textarea滚动条滚动
	panelTxt.onscroll = function(){
		panelNums.style.top = - this.scrollTop + 'px'
		console.log(this.scrollTop)
	}
	//清空按钮
	clearBtn.onclick = function(){
		panelTxt.value = '';
		var rowData = [];
		renderNums(rowData)
	}
	function checkCmds (){

	}
}
</script>
</body>
</html>